---
title: "DSI_Data_Challenge_5"
author: "Dingxin Lu"
date: "11/29/2021"
output: 
  html_document:
   df_print: paged
   toc: true 
   toc_depth: 2  
   number_sections: false
   toc_float:
     collapsed: true
     smooth_scroll: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = "center")
```

[My Github link] https://github.com/sydneydlu98/DSI_Data_Challenge_5

# Loading/Cleaning Data and Exploratory Analysis

In this Data Challenge, we will be clustering foods from the nndb_flat dataset provided on Canvas. To load/clean the data as well as perform some exploratory analysis:

1. Read in the data

```{r, message=FALSE}
## load all the packages
library(readr)
library(dplyr)
library(GGally)
library(tidyverse)
library(plotly)
library(ggplot2)

## read in data
data <- read_csv("nndb_flat.csv")
```

2. We will be dealing with only data that falls under the food groups of Vegetables and Vegetable Products, Beef Products, and Sweets. Filter the data to contain only these food groups.

```{r}
## filter the data to only contain food groups of Vegetables and Vegetable Products, Beef Products, and Sweets
object <-
  c("Sweets", "Beef Products", "Vegetables and Vegetable Products")

clean_data <- data %>%
  subset(FoodGroup %in% object)
```

3. Select only the variables from Energy_kcal to Zinc_mg

```{r}
var <- clean_data %>%
  select(Energy_kcal:Zinc_mg)
```

4. Examine the correlation among the variables using GGally::ggcorr. Which variables have a high correlation?

```{r}
GGally::ggcorr(var)
```


# Performing PCA

Steps for performing the PCA on the data:

1. Perform PCA on the data. Don’t forget to scale the data (if it is appropriate for this application)!
```{r}
data_scaled <- scale(var)

pca_data <- prcomp(data_scaled, 
                   center = FALSE, 
                   scale. = FALSE)

summary(pca_data)
```

2. Makat1e a plot showing the cumulative proportion of the variation explained by each PC with cumulative variation explained on the y-axis and PC on the x-axis.

```{r}
var_explainded <- summary(pca_data)$importance[2, ]
cumulative <- cumsum(var_explainded)

var_explained_df <- data.frame(PC = 1:23,
                               cum_var_explained = cumulative)

var_explained_df

var_explained_df %>%
  ggplot(aes(x = PC, y = cum_var_explained, group = 1)) +
  geom_point() +
  geom_line(lwd = 1) +
  labs(title = "Scree Plot: PCA",
       y = 'Cumulative Variation Explained',
       x = 'PC') +
  ggtitle("Plot of cumulative proportion of the variation explained by each PC") +
  theme(plot.title = element_text(hjust = 0.5, size = 16)) +
  # add line for better visualization
  geom_vline(xintercept = 3,
             linetype = 2,
             lwd = 1,
             col = "red") 
```

3. We will look at the first 3 PCs which explain about 60% of the variation in the data. Note that you may want to look at more depending on what your application is. Make 3 separate plots for the loadings for the first 3 PCs for all of the variables, ordered by the absolute value of the magnitude of the loadings.

```{r}
pca_loadings <- as.data.frame(pca_data$rotation) %>%
  dplyr::select(PC1, PC2, PC3) %>%
  mutate(variable = rownames(pca_data$rotation)) %>%
  pivot_longer(
    cols = c('PC1', 'PC2', 'PC3'),
    names_to = 'PC',
    values_to = 'loadings'
  )

ggplot(pca_loadings, aes(x = variable,
                         y = loadings)) +
  geom_bar(stat = 'identity') +
  facet_wrap(~ PC) +
  theme(axis.text.x = element_text(
    angle = 60,
    hjust = 1,
    size = 6
  )) +
  ggtitle("Plots for the loadings for the first 3 PCs for all of the variables") +
  theme(plot.title = element_text(hjust = 0.5, size = 16)) +
  labs(y = "Loadings", x = "Variables")
```

4. Make 3 plots of the scores on the PCs colored by food group. Plot the below scores. Make the plots interactive with plotly so you can identify the food description of any outliers.

```{r}
pca_scores <- as.data.frame(pca_data$x)

pca_scores <- pca_scores %>%
  mutate(FoodGroup = clean_data$FoodGroup) %>%
  mutate(description = clean_data$ShortDescrip)

pca_scores
```

* 1. PC1 versus PC2

```{r}
plot1 <- ggplot(pca_scores,
                aes(
                  x = PC1,
                  y = PC2,
                  col = FoodGroup,
                  label = description
                )) +
  geom_point() +
  ggtitle("PC1 versus PC2") +
  theme(plot.title = element_text(hjust = 0.5, size = 16))
  
ggplotly(plot1)
```

* 2. PC1 versus PC3

```{r}
plot2 <- ggplot(pca_scores, aes(x = PC1,
                                y = PC3,
                                col = FoodGroup,
                                label = description)) +
  geom_point() +
  ggtitle("PC1 versus PC3") +
  theme(plot.title = element_text(hjust = 0.5, size = 16))

ggplotly(plot2)
```

* 3. PC2 versus PC3

```{r}
plot3 <- ggplot(pca_scores, aes(x = PC2, 
                       y = PC3, 
                       col = FoodGroup,
                       label = description)) +
  geom_point() +
  ggtitle("PC2 versus PC3") +
  theme(plot.title = element_text(hjust = 0.5, size = 16))

ggplotly(plot3)
```

# Identify Outlier and Performing PCA Again

1. There is a major outlier on the plots above – which food is the outlier? Remove the outlier from your data.

**The major outlier on the plots above is yeast extract spread from the food group vegetable and vegatable products.**

Then we remove this outlier.

```{r}

```

2. Perform PCA again on the dataset without the outlier (steps 1-4 in the Performing PCA section above) and look at the loadings of the first 3 PCs. Have these changed? Investigate and comment on what could have caused any changes.

```{r}

```

3. Describe what you see in the plots of the scores and interpret this in conjunction with the loadings that you observed for the PCs.

```{r}

```

